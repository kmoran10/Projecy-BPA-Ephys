library(tidyverse)
rie <- read.csv("rawdata/rmp-impre-epsc-data.csv")
View(rie)
library(tidyverse)
library(ggpubr)
source("functions/geom_boxjitter.R")
rie <- read.csv("rawdata/rmp-impre-epsc-data.csv")
View(rie)
# RMP
rie %>%
ggplot(aes(group,RMP.pre, fill = group))+
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="RMP (pre)",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
# RMP
rie %>%
ggplot(aes(group,RMP.pre, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="RMP (pre)",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
View(rie)
rie %>%
ggplot(aes(group,RMP.ttx, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="RMP (ttx)",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
#xe
rie %>%
ggplot(aes(group,RMP.xe, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="RMP (xe)",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
rie %>%
select(1:8)
rie %>%
select(1,6:8)
rie %>%
select(1,5:8) %>%
pivot_longer()
rie %>%
select(1,5:8)
rie %>%
select(1,5:8) %>%
pivot_longer(col = c(6:8), names_to = "RMP timepoint", values_to = "RMP")
rie %>%
select(1,5:8) %>%
pivot_longer(col = c(3:5), names_to = "RMP timepoint", values_to = "RMP")
rmp.tp <- rie %>%
select(1,5:8) %>%
pivot_longer(col = c(3:5), names_to = "RMP.timepoint", values_to = "RMP")
#pre
rmp.tp %>%
ggplot(aes(group,RMP.timepoint, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="RMP (pre)",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
#pre
rmp.tp %>%
ggplot(aes(RMP.timepoint,RMP, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="RMP (pre)",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
rmp.tp %>%
ggplot(aes(RMP.timepoint,RMP, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="Resting Membrane Potential",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
rie %>%
select(1,5, 24:29)
rie %>%
select(1,5, 24:29) %>%
pivot_longer(col = c(3:8), names_to = "inre.timepoint", values_to = "inre")
rie %>%
select(1,5, 24:29) %>% mutate(
in.re.pre = (inp.pre.10 - inp.pre.n10) / 20,
in.re.ttx = (inp.ttx.10 - inp.ttx.n10) / 20,
in.re.xe = (inp.xe.10 - inp.xe.n10) / 20
)
rie %>%
select(1,5, 24:29) %>%
mutate(
in.re.pre = (inp.pre.10 - inp.pre.n10) / 20,
in.re.ttx = (inp.ttx.10 - inp.ttx.n10) / 20,
in.re.xe = (inp.xe.10 - inp.xe.n10) / 20
) %>%
select(1,2,9,10,11)
in.re.tp <- rie %>%
select(1,5, 24:29) %>%
mutate(
in.re.pre = (inp.pre.10 - inp.pre.n10) / 20,
in.re.ttx = (inp.ttx.10 - inp.ttx.n10) / 20,
in.re.xe = (inp.xe.10 - inp.xe.n10) / 20
) %>%
select(1,2,9,10,11)
View(in.re.tp)
rie %>%
select(1,5, 24:29) %>%
mutate(
in.re.pre = (inp.pre.10 - inp.pre.n10) / 20,
in.re.ttx = (inp.ttx.10 - inp.ttx.n10) / 20,
in.re.xe = (inp.xe.10 - inp.xe.n10) / 20
) %>%
select(1,2,9,10,11) %>%
pivot_longer(col = c(3:5), names_to = "Inp.re.timepoint", values_to = "Inp.re")
in.re.tp <- rie %>%
select(1,5, 24:29) %>%
mutate(
in.re.pre = (inp.pre.10 - inp.pre.n10) / 20,
in.re.ttx = (inp.ttx.10 - inp.ttx.n10) / 20,
in.re.xe = (inp.xe.10 - inp.xe.n10) / 20
) %>%
select(1,2,9,10,11) %>%
pivot_longer(col = c(3:5), names_to = "Inp.re.timepoint", values_to = "Inp.re")
in.re.tp %>%
ggplot(aes(Inp.re.timepoint,Inp.re, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="Input Resistance",x="Group", y = "RMP (mV)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
in.re.tp %>%
ggplot(aes(Inp.re.timepoint,Inp.re, fill = group))+
stat_compare_means(method = "t.test", size = 6, label.x = 1.5) +
geom_boxjitter(outlier.color = NA, jitter.shape = 21,
alpha = 1,
width = 0.5,
jitter.height = 0.02, jitter.width = 0.02, errorbar.draw = TRUE,
position = position_dodge(0.8)) +
scale_fill_manual(values=c("hotpink", "skyblue")) +
labs(title="Input Resistance",x="Group", y = "Input Resistance (MÎ©)") +
theme_classic() +
theme(axis.line = element_line(colour = 'black', size = 1),
axis.ticks = element_line(colour = "black", size = 1),
#        legend.position="none",
axis.text=element_text(size=16),
axis.title=element_text(size=18,face="bold"),
plot.title = element_text(size=24, hjust = 0.4))
View(rie)
mcd <- read.csv("rawdata/mc-data.csv")
View(mcd)
t(mcd)
tmcd <- t(mcd)
View(mcd)
tmcd <- as.data.frame(t(mcd))
View(tmcd)
tmcd <- as.data.frame(t(mcd))%>%
row_to_names(row_number = 1)
lapply(tmcd[1, ], as.character)
names(tmcd) <- lapply(tmcd[1, ], as.character)
tmcd <- tmcd[-1,]
tmcd1 <- tibble::rownames_to_column(tmcd, "ID")
View(tmcd1)
tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = FALSE) %>%
select(subject, everything())
tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything())
View(mcd)
rie <- read.csv("rawdata/rmp-impre-epsc-data.csv")
mcd <- read.csv("rawdata/mc-data.csv")
tmcd <- as.data.frame(t(mcd))
names(tmcd) <- lapply(tmcd[1, ], as.character)
tmcd <- tmcd[-1,]
tmcd1 <- tibble::rownames_to_column(tmcd, "ID")
tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything())
tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything()) %>%
separate(mc.tp, into = c("drug", "tp"), sep = "\\.", remove = FALSE) %>%
select(subject, everything())
tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything()) %>%
separate(mc.tp, into = c("drug", "tp"), sep = "\\.", remove = TRUE) %>%
select(subject, everything())
tmcd2 <- tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything()) %>%
separate(mc.tp, into = c("drug", "tp"), sep = "\\.", remove = TRUE) %>%
select(subject, everything())
View(tmcd2)
rie.id <- rie %>% select(subject,slice,pnd,group)
View(rie.id)
left_join(rie.id,tmcd2, by="subject")
a <- left_join(rie.id,tmcd2, by="subject")
View(a)
rm(a)
mcd3 <- left_join(rie.id,tmcd2, by="subject")
drop_na(mcd3$drug)
mcd3$drug <- as.factor(mcd3$drug)
drop_na(mcd3$drug)
View(mcd3)
mcd3[!is.na(mcd3$drug),]
mcd4 <- mcd3[!is.na(mcd3$drug),]
mcd3 <- left_join(rie.id,tmcd2, by="subject")
mcd4 <- mcd3[!is.na(mcd3$drug),]
View(mcd4)
mc.pro <- mcd4 %>%
mc.pro <- mcd4 %>%
mc.pro <- mcd4 %>%
select(1:4) %>%
distinct() %>%
filter(row_number() <= 2) %>%  # We only need 2 rows for TTX and XE
mutate(drug = c("TTX", "XE")) %>%
select(names(mcd4)[1:4], drug) %>%
bind_cols(
mcd4 %>%
filter(tp %in% c("Y1", "Y2", "Y3", "Y4")) %>%
group_by(subject, drug, grp = if_else(tp %in% c("Y1", "Y2"), "Y12", "Y34")) %>%
summarise(across(7:17, mean), .groups = "drop") %>%
pivot_wider(names_from = grp, values_from = 4:14)) %>%
mutate(across(ends_with("Y12") - across(ends_with("Y34"))) %>%
group_by(subject, drug_grp = if_else(drug %in% c("TTX1", "TTX2"), "TTX", "XE")) %>%
summarise(across(ends_with("Y12"), mean), .groups = "drop") %>%
pivot_longer(cols = -(1:2), names_to = "var", values_to = "val") %>%
mutate(var = str_remove(var, "_Y12")) %>%
pivot_wider(names_from = var, values_from = val) %>%
select(-subject) %>%
filter(drug_grp %in% c("TTX", "XE")) %>%
rename(drug = drug_grp))
mc.pro <- mcd4 %>%
# First create the skeleton with first 4 columns and TTX/XE labels
select(1:4) %>%
distinct() %>%
slice(1:2) %>%  # We only need 2 rows for TTX and XE
mutate(drug = c("TTX", "XE")) %>%
select(names(mcd4)[1:4], drug) %>%
# Join with the calculated values
bind_cols(
mcd4 %>%
filter(tp %in% c("Y1", "Y2", "Y3", "Y4")) %>%
# Group by subject and drug, with timepoint groups
group_by(subject, drug, grp = if_else(tp %in% c("Y1", "Y2"), "Y12", "Y34"))) %>%
# Calculate means for all numeric columns (adjust the range as needed)
summarise(across(where(is.numeric), mean, .groups = "drop") %>%
# Pivot wider to get Y12 and Y34 columns side by side
pivot_wider(names_from = grp, values_from = where(is.numeric)) %>%
# Calculate differences (Y12 - Y34)
mutate(across(ends_with("Y12"), .names = "{.col}_diff") -
across(ends_with("Y34"))) %>%
# Group by subject and drug group (TTX or XE)
group_by(subject, drug_grp = if_else(drug %in% c("TTX1", "TTX2"), "TTX", "XE")) %>%
# Average the differences within each drug group
summarise(across(ends_with("_diff"), mean), .groups = "drop") %>%
# Pivot to tidy format then back to wide
pivot_longer(cols = ends_with("_diff"), names_to = "var", values_to = "val") %>%
mutate(var = str_remove(var, "_Y12_diff")) %>%
pivot_wider(names_from = var, values_from = val) %>%
select(-subject) %>%
filter(drug_grp %in% c("TTX", "XE")) %>%
rename(drug = drug_grp))
# Step 1: Calculate Y1/Y2 and Y3/Y4 averages for each subject and drug
timepoint_avgs <- mcd4 %>%
filter(tp %in% c("Y1", "Y2", "Y3", "Y4")) %>%
mutate(time_group = if_else(tp %in% c("Y1", "Y2"), "Y12", "Y34")) %>%
group_by(subject, drug, time_group) %>%
summarise(across(where(is.numeric), mean), .groups = "drop")
# Step 2: Calculate Y12 - Y34 differences
time_diffs <- timepoint_avgs %>%
pivot_wider(names_from = time_group, values_from = where(is.numeric)) %>%
mutate(across(ends_with("Y12"), .names = "diff_{.col}") -
across(ends_with("Y34"))) %>%
select(subject, drug, starts_with("diff"))
# Step 3: Average differences for TTX and XE groups
drug_group_avgs <- time_diffs %>%
mutate(drug_group = case_when(
drug %in% c("TTX1", "TTX2") ~ "TTX",
drug %in% c("XE1", "XE2") ~ "XE",
TRUE ~ NA_character_
)) %>%
filter(!is.na(drug_group)) %>%
group_by(subject, drug_group) %>%
summarise(across(starts_with("diff"), mean), .groups = "drop")
# Step 4: Create final output dataframe
# First get the first 4 columns from original data (one row per subject)
subject_info <- mcd4 %>%
select(1:4) %>%
distinct()
# Combine with the calculated values for TTX and XE
mc.pro <- expand_grid(
subject_info,
drug = c("TTX", "XE")
) %>%
left_join(
drug_group_avgs %>%
rename(drug = drug_group),
by = c("subject", "drug")
) %>%
# Clean up column names (remove "diff_" prefix and "Y12" suffix)
rename_with(~ str_remove(str_remove(., "diff_"), "_Y12"), starts_with("diff"))
View(drug_group_avgs)
# M-current
library(tidyverse)
library(ggpubr)
source("functions/geom_boxjitter.R")
rie <- read.csv("rawdata/rmp-impre-epsc-data.csv")
mcd <- read.csv("rawdata/mc-data.csv")
rie.id <- rie %>% select(subject,slice,pnd,group)
tmcd <- as.data.frame(t(mcd))
names(tmcd) <- lapply(tmcd[1, ], as.character)
tmcd <- tmcd[-1,]
tmcd1 <- tibble::rownames_to_column(tmcd, "ID")
tmcd2 <- tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything()) %>%
separate(mc.tp, into = c("drug", "tp"), sep = "\\.", remove = TRUE) %>%
select(subject, everything())
mcd3 <- left_join(rie.id,tmcd2, by="subject")
mcd4 <- mcd3[!is.na(mcd3$drug),]
# Step 1: Calculate Y1/Y2 and Y3/Y4 averages for each subject and drug
timepoint_avgs <- mcd4 %>%
filter(tp %in% c("Y1", "Y2", "Y3", "Y4")) %>%
mutate(time_group = if_else(tp %in% c("Y1", "Y2"), "Y12", "Y34")) %>%
group_by(subject, drug, time_group) %>%
summarise(across(where(is.numeric), mean), .groups = "drop")
View(timepoint_avgs)
# Step 2: Calculate Y12 - Y34 differences
time_diffs <- timepoint_avgs %>%
pivot_wider(names_from = time_group, values_from = where(is.numeric)) %>%
mutate(across(ends_with("Y12"), .names = "diff_{.col}") -
across(ends_with("Y34"))) %>%
select(subject, drug, starts_with("diff"))
View(time_diffs)
# M-current
library(tidyverse)
library(ggpubr)
source("functions/geom_boxjitter.R")
rie <- read.csv("rawdata/rmp-impre-epsc-data.csv")
mcd <- read.csv("rawdata/mc-data.csv")
rie.id <- rie %>% select(subject,slice,pnd,group)
tmcd <- as.data.frame(t(mcd))
names(tmcd) <- lapply(tmcd[1, ], as.character)
tmcd <- tmcd[-1,]
tmcd1 <- tibble::rownames_to_column(tmcd, "ID")
tmcd2 <- tmcd1 %>%
separate(ID, into = c("mc.tp", "subject"), sep = "_", remove = TRUE) %>%
select(subject, everything()) %>%
separate(mc.tp, into = c("drug", "tp"), sep = "\\.", remove = TRUE) %>%
select(subject, everything())
mcd3 <- left_join(rie.id,tmcd2, by="subject")
mcd4 <- mcd3[!is.na(mcd3$drug),]
View(mcd4)
View(mcd4)
# 1. First get Y12 (Y1/Y2 average) and Y34 (Y3/Y4 average) for each subject/drug
avg_by_period <- mcd4 %>%
filter(tp %in% c("Y1", "Y2", "Y3", "Y4")) %>%
mutate(period = if_else(tp %in% c("Y1", "Y2"), "Y12", "Y34")) %>%
group_by(subject, drug, period) %>%
summarise(across(where(is.numeric), mean), .groups = "drop")
View(avg_by_period)
# 2. Calculate Y12 - Y34 differences for each subject/drug combo
period_differences <- avg_by_period %>%
pivot_wider(names_from = period, values_from = where(is.numeric)) %>%
mutate(across(starts_with("Y12"), .names = "diff_{.col}") -
across(starts_with("Y34"))) %>%
select(subject, drug, starts_with("diff"))
# 2. Calculate Y12 - Y34 differences for each subject/drug combo
period_differences <- avg_by_period %>%
pivot_wider(names_from = period, values_from = where(is.numeric)) %>%
mutate(across(starts_with("Y12"), .names = "diff_{.col}") -
across(starts_with("Y34"))) %>%
select(subject, drug, starts_with("diff"))
